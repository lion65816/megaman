====================================================================================================
ロックマン３　トゲをダメージ化

・ウェブサイト
　　　　　http://borokobo.web.fc2.com/
　　　　　（Neoぼろくず工房）
　　　　　http://www.geocities.jp/borokobo/
　　　　　（Neoぼろくず工房別館）

====================================================================================================
●あいさつ
　本パッチをＤＬしていただき、ありがとうございます。

●免責
　使用は自己責任でお願い致します。

●概要
　即死のトゲ(属性50)をダメージ(デフォルトで4ダメージ)に変更します。
　また、原作未使用の、ノックバックのみ受ける地形(属性30)に
　ダメージを指定できます。つまり、２種類の強度のトゲを利用できます。

●ダメージ調整方法
　パッチを当てた後のバイナリから、
60 80 84
　を検索し、後ろの２バイトがダメージ量です。
　それぞれ、+80した値を指定します。
　80となっている部分が、原作未使用のノックバック地形(属性30)のダメージです。(ノーダメージ)
　84となっている部分が、トゲ(属性50)のダメージです。(4ダメージ)

●不具合・補足など
・基本的にロクにテストしていないのでバグるかもしれません。
・原作では、ノックバックのみを受ける地形は、
　横から触っても何も起きなかったのですが、
　トゲ同様、横から触っても反応するように変更してあります。
（トゲとの対称性の問題もあるが、容量確保のためでもある）
　また、原作とは違い、ノックバック時に効果音もなるようになっています。

●更新履歴
◎Ver.1.00(2016年7月3日)
　初版

●ソース・利用条件など
　ご自由に流用してください。
　以下、アセンブリソースとなっています。
　私にしか通用しないような表現やマクロ等がありますが、
　適時置き換えてお読みください。

	BANKORG_D $1FE9C8 ;縦に触れた時の処理から飛ばす
	TRASH_GLOBAL_LABEL
	;属性30はy=0　属性50はy=1　とする。
	ldy #$00
	lda <$41
	cmp #$30
	beq .Spike1
	cmp #$50
	bne $E9D8
	iny
.Spike1
	jsr NerfedSpike
.NoDamageSpike
	ORG_TEST $1FE9D8

	BANKORG_D $1FEAE3 ;横に触れた時の処理を、縦に触れた時に繋ぎ、容量確保
	bne $EB1C
	jmp $E9B6
NerfedSpike:
	sec
	lda <$A2 ;HP
	sbc .Tbl_Damage,y
	bpl .NotFixHP
	lda #$00
.NotFixHP
	;ライフがゼロになったらティウン状態に、
	;まだ残っていればノックバック状態にしつつ、ダメージ音を鳴らす
	ldy #$0E
	ora #$00
	beq .Dead
	jsr NerfedSpike_SE
.Dead
	sty <$3D
	ora #$80
	sta <$A2 ;HP
	rts

.Tbl_Damage ;ダメージのテーブル　+80した値を指定する
	db $80,$84
	ORG_TEST $1FEB04

	BANKORG_D $1FFFD1 ;どうしても収まらなかったので、ROM後方の狭いスペースを利用する
NerfedSpike_SE:
	pha
	lda #$16
	jsr $F89A
	ldy #$06
	pla
	rts
