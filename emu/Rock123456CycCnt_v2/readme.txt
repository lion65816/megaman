==============================================================================================
ロックマン１〜６（＋α）処理サイクルカウンタ＆CPU空きサイクル測定Lua

・配布元ウェブサイト
　　　　　http://borokobo.web.fc2.com/
　　　　　（Neoぼろくず工房）
　　　　　http://www.geocities.jp/borokobo/
　　　　　（Neoぼろくず工房別館）

==============================================================================================

●免責
　このLuaスクリプトはフリーなものです。
　自由に使えますが、
　このスクリプトが存在したことによる世の中へのいかなる影響も
（一例：使用したことによるコンピュータや操作者への損害・損傷）
　私は責任を負いません。

●概要
　ファミコンのロックマンの各種処理にかかった時間をそこそこの精度で測定するための
　FCEUX向けのLuaスクリプトです。
　また、どの程度処理に余裕があったかを測定するLuaも付属しています。

●使用法
　nesエミュFUCUXにて、対象のROMを実行した後、
　エミュ窓に、対応するLuaファイルをドロップして下さい。

●スクリプト一覧
・_Sub_CPUUsage.lua
・_Sub_CycCnt.lua
　この２つのファイルは、他のスクリプトが利用するので同じフォルダに存在している必要があります。

・Rock*_CycCnt.lua (*=1〜6)
　各処理にかかった時間を測定するためのLuaスクリプトです。

・Rock*_CPUUsage.lua (*=1〜6)
　処理にどのくらい余裕があったかをグラフ化するLuaスクリプトです。

・WideUse_CPUUsage.lua
　おまけ、です。多くのnesソフトに対応しているかもしれない、
　処理にどのくらい余裕があったかをグラフ化するLuaスクリプトです。ダメなソフトも多いです。

●補足など
○以前のバージョンでは、サイクル数計測のため、
　FinalFighterさんのLuaと、FCEUXのソースファイルを参考にしていました。
　WideUse_CPUUsage.luaでは今も利用しています。
○Rock*_CycCnt.luaについて
　・ゲームシーンの測定のみに対応しています。
　　ゲームが始まってからLuaを起動したほうがわかりやすいと思います。
　・リストのどの項目が何の処理に対応しているかは、
　　ラベル名と、Rock*_CycCnt.lua内のテーブルをみて判断して下さい。
　・ロックマン2版にて、ボスラッシュのステージには対応していません。
　・ロックマン5版にて、チャージマンステージとウェーブマンステージの一部の箇所において
　　リストの更新間隔が半減し、30FPS表示になります。
　・ロックマン6版にて、一部の状態において、Audio+という項目の値がおかしくなります。
　　実際のオーディオ処理は、続く項目の「どこかで」行われます。
　・どの版においても、ラスタースクロールのためのIRQハンドラ処理にかかるサイクル数は、
　　IRQが起こった瞬間に行っていた処理に編入されています。
　・DPCM利用による負荷の増大にもたぶん対応できているはずです。
　　ロックマンでDPCM使うように改造する人は小数だと思いますが……
　・エミュの機能を使っているのでたぶん正確だと思いますが
　　何か間違いに気づかれた方は、その旨をご連絡を頂ければ対応できるかもしれません。（期待薄）
○Rock*_CPUUsage.luaについて
　・ゲームシーンの測定のみに対応しています。
　　ゲームが始まってからLuaを起動したほうがわかりやすいと思います。
　・右下に表示される値は、１つ前のフレームに何サイクル余裕があったかを表します。
　・グラフは右が最新、左ほど前のフレームになります。一番右は数字に対応しています。
　・グラフの赤いラインは、処理落ちが起こったらしい事を表します。
　　赤いラインは長めになる傾向がありますが、これは、
　　本来１フレームで行われる処理が２フレーム分の時間で行われるため、
　　２フレーム目に余裕が大きくなることに起因します。
　・ルーム間スクロールやアイテムによる回復、サブ画面開閉中等は、
　　ずっとラグっているような扱いになっています。
　　これらの状態が終わるときに赤いバーが表示されますが、ラグではありません。
　・シビアなタイミングにおいて、処理落ちが起きても赤いバーが表示されないことがあります。
○WideUse_CPUUsage.luaについて
　・一部のソフトにのみ対応しています。
　　ROMを切り替えたら、Luaも読みなおして下さい。
　・エミュの機能を使わずに計測しているので重いです。
　・赤いラインはやはりラグを表しますが、どうも精度が甘いようです。
　　ラグを見逃したり、ラグったのに表示されなかったり……
　・ソフトにもよりますが、NMI待ちループのサイズを検出するために
　　実行後しばらく時間がかかることがあります。
　　左上のほうで何かがチラチラしている時は検証中です。
　・スクリプトを見ればわかりますが、試作品丸出しな物となっています。
　・手持ちのソフトで色々試してみたところ、
　　なーんか上手く行っているような上手く行っていないようなよくわからん奴も多いですが、
　　そこそこうまく行っているように見えるものも結構あります。
　　傾向としては、60fpsでないゲームはまず上手くいかないようで、
　　アクションやシューティング以外も上手くいかない事が多いようです。

●履歴
　○初版(2014年3月23日)

　○Version 2(2015年8月30日)
　　サイクル数測定にエミュが提供するLua関数を利用するように変更したことで
　　Luaの構造を大幅に単純化し、処理負荷も大きく低減、精度も向上した。


●利用についてなど
　ご自由にどうぞ。改変とかも。
