==============================================================================================

ゆらゆらろっく Version 0.31

・配布元ウェブサイト
　　　　　http://borokobo.web.fc2.com/
　　　　　（Neoぼろくず工房）
　　　　　http://www.geocities.jp/borokobo/
　　　　　（Neoぼろくず工房別館）

==============================================================================================

●免責
　このソフトはフリーウェアです。
　自由に使えますが、
　このソフトが存在したことによる世の中へのいかなる影響も
（一例：使用したことによるコンピュータや操作者への損害・損傷）
　私は責任を負いません。

●概要
　ファミコンのロックマンである、ロックマン１〜６のエディタです。
　癖の強いエディタであるため、作業前後にバックアップを怠らないで下さい。


●下準備
　以前のバージョンでは、予め、このソフトのフォルダに、
rockman1.nes
rockman2.nes
rockman3.nes
rockman4.nes
rockman5.nes
rockman6.nes
　を準備しておくと良かったのですが、今のバージョンでは必要ありません。
　また、このエディタは、独自のNesパレットを利用しますが、かなり酷いので、
　気になる方は、dataフォルダの中に、パレットファイルを
nes.pal
　という名前で準備してください。

●大体の編集の流れ
(1)起動。この時画面に表示されたボタンには触れない。
(2)改造したいROMを、ウインドウにドロップ
　なお、rockman*.nesという名前のファイルは変更できません。
(3)色々改造
　改造方法の詳細は、順次解説します。
(4)F11で書き込み(上書きのみ、別名保存はできません)

●共通操作
○大体のシーンで使えるキー操作
F1/F2   :編集モード切り替え
F3/F4   :グラフィック切り替え
F5/F6   :ステージ切り替え(直接編集時)
  F9    :編集モードに対応した画像を出力する
 F11    :ROM保存(直接編集時)
 A/S    :ルームをX方向に移動　同時押しでX=0の地点に移動　Shiftで速く
 Z/W    :ルームをY方向に移動　同時押しでY=0の地点に移動　Shiftで速く
 Tab    :表示の切り替え(通常→白黒→判定→通常……)
Ctrl+Tab:未配置チップにチェックを付ける
         (※配置されていないだけで利用されていないとは限らない)
Shift+Tab:画面番号の表示/非表示トグル

○タイルエディタ操作方法
（※タイルエディタ……右下のパターンを選択して画面に置いていく機能全般）
　●通常時
　・ドラッグ　　　　マップ配置
　・右ドラッグ　　　スポイト
　・Shift+クリック　横塗りつぶし
　・Ctrl +クリック　縦塗りつぶし
　・Shift+Ctrl+クリック　いわゆる塗りつぶし
　・PageUp　　　　　アンドゥ
　・PageDown　　　　リドゥ
　・カーソルキー　　パレットで選択中の部品を左右上下に移動
　・中央ドラッグ　　範囲選択
　・Delete　　　　　選択範囲を選択中タイルで塗りつぶし
　・C 　　　　　　　選択範囲のコピーを実行
　・Ctrl+C　　　　　選択範囲のコピーを実行しつつクリップファイルを出力
　・クリップファイルをドロップ　クリップファイルをロードしコピー状態に移行
　・パレットを中央ドラッグ　パレットの矩形範囲をコピー
　●コピー状態
　・中・右クリック　コピー状態解除
　・ドラッグ　　　　コピーしたものを貼り付け
　・Shift+クリック　マスキング貼り付け(選択中タイルの上のみに貼り付け)
　・Ctrl+クリック 　00透過貼り付け

　クリップファイルというのは、選択領域をまるごと保存できるものです。
　それをウインドウにドロップすれば、その領域をペーストできるので便利。
　クリップファイルは、エディタのフォルダに
　chipclip.rstgclip、clipped.rstgclipといった、
　.rstgclipという拡張子で出力されます。
　拡張子.rstgclipを保っていれば、自由にリネームすることができます。
　便利な部品を.rstgclipとして集めれば、作業能率がぐっと上がると思います。

●モード別詳細説明
○起動説明モード
　起動時のモード。編集したいROMのドロップを受け付ける他、
　誤って「rstg編集」に迷い込まないための措置です。
「rstg編集」とは、当初のゆらゆらロックで取っていた方式なのですが
　あまりにも仕組みが煩雑になりすぎ、実用性が極端に低くなった編集方法です。
　そのような前提の上でどうしてもrstg編集を使いたい場合は、
　ボタンを押すとrstgを取り出すモードへ移行します。それらのモードの説明は省略します。

○チップ編集モードについて（ロックマン３〜６）
　●概要
　　ここで、16x16サイズの部品（チップ）を作成します。
　　8x8サイズの絵を、縦横に2つずつ並べて作られます。
　　また、色を４パターンから選択します。
　　さらに、チップの段階で当たり判定を持ちます。
　「マウスでポイントしながらボタンを押す」という
　　若干独特な操作方法ですが、慣れると多くのチップをあっという間に定義できます。
　●操作方法
　・大体は、前述のタイルエディタ操作方法を参考にしてください
　・対象のチップをマウスカーソルでポイントしながら、
　　12345678QWERTYUIのどれかを押すことで、判定の書き換えができます。
　　Tabを押して、判定表示に切り替えてから利用してください
　・対象のチップをマウスカーソルでポイントしながら、
　　ASDFのどれかを押すことで、利用するパレットの切り替えができます。
　・対象のチップをマウスカーソルでポイントしながら、
　　ZXを押すことで、未使用の判定ビットを操作することができます。
　　Tabを押して、判定表示に切り替えてから利用してください

○マップ編集モード
　●概要
　　ここで、マップ全体を作成します。サイズ制限が厳しいのでご注意ください。
　　上下二段になっていますが、
　　ロックマン３〜６では下段はワーク領域としてご利用いただけます。
　（一時的にパターンを貼り付けておくなど）

　　ロックマン１〜２の場合は、見かけが上段、判定は下半分を利用します。
　　両方書き換えないと正しくならないのでご注意下さい。
　　下半分は、見かけに反映されないため、
　　Tabで判定表示をして、パレットから適当な判定のチップを選び利用して下さい。
　●操作方法
　　前述のタイルエディタ操作方法を参考にしてください
　　このモードの時にLuaスクリプトファイルをウィンドウにドロップすると
　　Luaスクリプトを使った編集を行うことが可能です。
　　詳しくはLuaフォルダ内のreadme.txtを参照して下さい。
　●コツみたいなもの
　　だいたい、ボス部屋の後ろの方に、要らないデータがあります。
　　無駄な容量を食うので潰しておきましょう。
　　中央ドラッグで選択した後、適当なタイルでDel塗りつぶしすればOKです。
　　１〜２の場合は、下半分もまとめて潰しておきましょう。

　　16x16単位で編集可能とはいえ、
　　きちんと32x32タイルを頭の片隅にいれてマップを配置しないと
　　あっという間に256タイルを使い果たします。
　　32x32単位で、コピペを利用してくと、容量の節約になるでしょう。

○マップ編集モード→保護モード
　●概要
　　このエディタは32x32タイルを完全に破壊して再構成するという仕様です。
　　しかし、ROMをロードした時に含まれていた
　　32x32タイルのいくつかを変更したくないときは、
　　その部分を「保護」することができます。
　「マップ編集モード」にて、画面下部の、「Tile保護」をクリックし、
　　32x32タイルの保護状態を編集することができます。
　●操作方法
　　省略。下部の説明をご覧ください。
　●補足
　　現バージョンでは、保護状態はセーブされないので、
　　ROMをロードしたりステージを切り替える度に設定し直す必要がある謎仕様となっております。

　　なお、ロックマン１・３において、必要な部分が自動で保護されるようになっています。
　　ロックマン１では「ブロックを持ち上げた時に現れる地形」、
　　ロックマン３では「ブルースと戦った後、破壊され現れる地形」が該当します。

○オブジェクト編集モード
　●概要
　　ここで、敵やアイテムなどを配置します。
　　時には、ゲームを制御する役割を持つ者を配置することもあります。
　●操作方法
　　　それなりに常識的な操作方法を受け入れると思います。
　　・オブジェクトをクリック　　　単一選択
　　・オブジェクトを右クリック　　単一選択(動かしたくない時に便利)
　　・オブジェクトをCtrlクリック　選択切り替え
　　・オブジェクトをCtrl右クリック　選択切り替え(動かしたくない時に便利)
　　・オブジェクト以外をクリック　選択解除
　　・オブジェクト以外からドラッグ　範囲選択
　　・ドラッグ　　　　　　　　　　選択中オブジェクトの移動
　　・Ctrl+ドラッグ 　　　　　　　選択中オブジェクトの4Dotスナップ移動
　　　　　　　　　　　　　　　　　※Ctrlをあとで押すのがコツ
　　・Shift+ドラッグ　　　　　　　選択中オブジェクトを妥当な高さ(16Dot単位)にスナップ移動
　　・Delete　　　　　　　　　　　選択中オブジェクトを削除
　　・Ctrl+オブジェクト以外クリック　オブジェクトの配置
　　　　　　　　　　　　　　　　　選択中オブジェクトが複製される形で
　　　　　　　　　　　　　　　　　そのオブジェクトの次に挿入される
　　・Ctrl+A　　　　　　　　　　　全選択
　　・Ctrl+中央クリック 　　　　　その座標より右のオブジェクトを右に1ページ移動
　　・Ctrl+Shift+中央クリック 　　その座標より右のオブジェクトを左に1ページ移動
　　・オブジェクトを中央クリック　自動浮かし(後述)
　　・Enter 　　　　　　　　　　　X座標ソートを実行(不意打ちが台無しになります)
　　・Ctrl+Enter(1,6のみ) 　　　　「Obj領域の再割当」を行う
　　・敵名前リストをクリック　　　選択中オブジェクトの種類を変更する
　　・敵名前リストを右クリック　　敵名前リストを押している間スクロール
　　　　　　　　　　　　　　　　　端っこを押すほど速くスクロールする
　　・敵名前リストを中ドラッグ　　敵名前リスト移動
　　・バイナリエディタ入力　　　　選択中オブジェクトの変更を適用する
　　　　　　　　　　　　　　　　　左から、ページ、X、Y、種類、であり、時々便利である。

　●自動浮かし機能について
　　地面や天井に居る雑魚を、壁面から浮いたりめり込んだりしないように調整する機能です。
　　この機能は、Shift+移動によるスナップ移動により、ほぼ無意味な機能になりました。

　　利用方法は、まず、オブジェクトを半分程度、床や天井にめり込ませて配置します。
　　その後、そのオブジェクトを中央クリックすることで、オブジェクトが適当な高さに移動します。
　　なお、どのくらい浮かせるかは、data/DeltaYList*.txtにデータになっています。
　　原作でもどのくらい浮かせて置いているかは一意ではないので、まあ適当に。

○特殊設定モード
　ステージ固有の設定を行う。例えば、部屋の大きさや繋がり方の設定など。
　操作はバイナリエディタ入力で行う。エディタの意味とは何だったのか。
　一応、言い訳をすると、結局内部での値の持ち方を考慮しないと
　逆に混乱を招くのではないか、という方針によるものらしい。
　バイナリエディタは、16の位も1の位もクリックで選択できる。
　0-9やA-Fで書き換え可能である他、
　H,J,N,Mで、1ずつもしくは10ずつ加算減算可能である。
　
　なお、このモードの時にF9を押すと、マップ全体を繋げて出力することができます。

○その他の編集モード
　シリーズによっては、他にも編集モードがあります。
　操作方法は他のモードとだいたい同じです。
　大抵操作説明も表示してあるため、それも参考に編集して下さい。

●その他の機能
　○画像読み込み機能
　　ステージによっては、途中でグラフィックのパターンが変更されることがあります。
　　そのようなステージに対応するために、数パターンの画像を指定することができます。
　　ロックマン6以外では、中間地点のデータ等を利用し、予め数パターンの画像が指定されています。
　　F3/F4で、そのパターンを指定することができます。

　　また、このパターンは自分で作ることもできます。以下の手順を踏んで下さい。
　・グラフィックが変わるステージに入り、実際に変わる場所までプレイする
　・PPU Memory Dumpを出力する
　　エミュにより方法は異なります。
　　FCEUXだと、Debug->Hex Editorの窓の、File->Dump to file->PPU Memory
　　VirtuaNESではできないらしい。
　・出力されたファイルを、
　　(.rstgのファイル名).ppu
　　とリネームする。例えば、hoge.rstgを編集するなら、hoge.ppuとする。
　　さらに、.rstgと同じフォルダに入れる。
　　直接編集時(通常時)は、アプリケーションと同じフォルダにて、
　　#tmp_4_00#.rstgといった名前の.rstgファイルが編集されている扱いになっているので、
　　#tmp_4_00#.ppu等としてアプリケーションと同じフォルダに入れる。
　・すると「表示1/4」として表示されるようになる
　　なお、BGの色も読み込まれる。
　・拡張子の前を一定の名前にすると、1/4以外の場所にも割り当てられる
　　1/4……*.ppu もしくは *.1.ppu
　　2/4……*.2.ppu
　　3/4……*.3.ppu
　　4/4……*.4.ppu

　○rstg編集
　　このreadmeでも何度か出てきましたが、普通にROMに書き込む「直接編集」以外に、
　　古いゆらゆらロックで使われていた方法である、rstg編集があります。
　　一応そちらも説明しようと思ったのですが、煩雑になるだけなのでやめます。

●更新履歴
　○Version 0.01(2012年10月8日)
　　・初版
　○Version 0.02(2012年1月11日)
　　・微更新
　○Version 0.10(2013年2月24日)
　　・編集の方針を大幅に変更
　　・ロックマン６に対応
　　・その他色々
　○Version 0.11(2013年6月9日)
　　・ロックマン２に対応
　　・その他色々
　○Version 0.12(2013年8月17日)
　　・ロックマン３に対応
　　・その他色々
　○Version 0.20(2013年9月29日)
　　・ロックマン１に対応
　　・出力時のタイル作成に、アプリケーションのフォルダのrockman*.nesではなく
　　　ROMが読み込まれた時の状態を参考にするように変更
　　・32x32タイルの保護モードを追加
　　・オブジェクト移動のShift同時移動による適当な高さへのスナップを追加
　　・特殊設定モードにおける、F9による、マップ全体出力機能を、
　　　ロックマン２では修正、ロックマン６で追加。
　　・その他色々
　○Version 0.21(2013年10月5日)
　　・ロックマン１の「Obj領域の再割当」の深刻な不具合を修正
　○Version 0.22(2014年3月16日)
　　・ロックマン５のゲームシーン以外の画面編集の保存が正しく行われない不具合を修正
　○Version 0.30(2017年5月1日)
　　・Luaスクリプトを利用した編集機能を追加
　○Version 0.31(2018年12月10日)
　　・ロックマン１において、エレキ・ガッツステージで「変化地形編集モード」を利用すると
　　　タイトル画面が正常に表示されなくなり、
　　　また、ワイリーマシン出現時にクラッシュする不具合を修正

●謝辞
　敵リストとして、Rock5easilyさんのエディタに付属の敵リストをほぼそのまま無断利用しています。
　勝手に利用してすみません。そして多くの先進的改造の先駆者であるRock5easilyさんに敬礼！

●ライセンス
　本アプリケーションはLuaスクリプト言語を使用しています。
　http://www.lua.org/
　LuaはMITライセンスで公開されています。
　http://www.lua.org/license.html

●ソース
　srcフォルダにこのソフトウェアのソースを同封しています。
　相当拙いコーディングですが、お許し下さい。
　ソースの改変は自由ですし、改造したものを公開しても問題ないですが、
　生じた問題は全て自分で解決してください。
　ただし、このソースの一部でも使用した場合は、そのソフトのソースは公開するようにお願いします。
