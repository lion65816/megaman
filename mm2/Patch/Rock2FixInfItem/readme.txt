ロックマン2 無限アイテム修正パッチ version 0.01

・配布元ウェブサイト
　　　　　http://borokobo.web.fc2.com/
　　　　　（Neoぼろくず工房）
　　　　　http://www4.atpages.jp/borokobo/
　　　　　（Neoぼろくず工房別館）

●概容
　ロックマン2の改造において、アイテムを敵扱いで配置することで、
　無限に出現させるテクニックは常套手段です。
　しかし、本来ロックマン2のプログラムでは、この方法に対応しておらず、メモリに不整合が生じます。
　それにより、1番目の本当に配置されたアイテムが出現しなくなってしまったり、
　一旦表示されたはずのアイテムが、ちょっと画面から出すと再び出現しなくなったりする問題が起きます。

　このパッチは、プログラムを修正することにより、
　アイテムを敵扱いで配置することを、不整合無く可能にするものです。

●使用法
　ipsパッチ
Rock2FixInfItem001.ips
　を適当なソフトで当ててください。

●補足
・基本的にロクにテストしていないのでバグるかもしれません。
・未使用領域を利用しているので、同じく未使用領域を利用した
　他のパッチと併せて利用することができません。
・メモリの不整合とは
　敵扱いで配置されたアイテムを取ると、1番目のアイテムの取得フラグがセットされます。
　これにより、本当に1番目に配置されていたアイテムが出現しなくなります。
　また、敵扱いで配置されたアイテムは、取ったり画面外に出しても、
「画面内にその敵が存在しているフラグ」がクリアされません。
　このフラグは、配置された１つ敵が、２体以上呼ばれないようにするためのフラグですが、
　この現象により、このフラグが新たに発生した別の敵に上書きされるまでは、
　再び画面内に収めても出現しなくなってしまいます。
・修正方法
　敵が落とすアイテムと配置されたアイテムは同じルーチンを使っているのでややこしい。
　各フラグを確認した上で、妥当にフラグの上げ下げをすることで対応した。

●ソース・再配布など
	BANKORG_D $1DBD04
	jmp InfItem

	BANKORG_D $1FF2B0
InfItem:
	lda $0120,x ;アイテムとして配置されたものなら、ここに非負数が書き込まれている
	bmi .NotPlacedAsItem
	jmp $EF8D
.NotPlacedAsItem
	inc $04E0,x ;アイテム取得フラグを操作しないように一旦調整
	jsr $EF91
	dec $04E0,x
	;画面外に出るなどして消滅したら、配置IDをクリアする
	lda $0420,x ;フラグ
	bmi .Exists
	lda #$FF
	sta $00F0,x
.Exists
	rts

　ご自由にお使いください。
　再配布、再改造などもご自由に。改造への組み込みもご自由に。
　ドキュメントにその旨を書いていただけると私が大喜びします。
