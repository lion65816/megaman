====================================================================================================
ロックマン２　トゲをダメージ化

・ウェブサイト
　　　　　http://borokobo.web.fc2.com/
　　　　　（Neoぼろくず工房）
　　　　　http://www.geocities.jp/borokobo/
　　　　　（Neoぼろくず工房別館）

====================================================================================================
●あいさつ
　本パッチをＤＬしていただき、ありがとうございます。

●免責
　使用は自己責任でお願い致します。

●概要
　即死のトゲをダメージ(デフォルトで4ダメージ)に変更します。

●ダメージ調整方法
　パッチを当てた後のバイナリから
AD C0 06 E9 04
　を検索した時、最後のバイトの04がダメージ量です。

●不具合・補足など
・基本的にロクにテストしていないのでバグるかもしれません。
・ノックバック方向は、向いている方向と逆です。

●更新履歴
◎Ver.1.00(2016年7月3日)
　初版

●ソース・利用条件など
　ご自由に流用してください。
　以下、アセンブリソースとなっています。
　私にしか通用しないような表現やマクロ等がありますが、
　適時置き換えてお読みください。

	BANKORG_D $1C8A5E ;トゲに横から触れた時
	jsr NerfedSpike_H
	lda #$03
	nop
	nop

	BANKORG_D $1C8CC2 ;トゲに縦に触れた時
	jsr NerfedSpike_V
	ldx #$00
	nop
	nop

	BANKORG_D $1FF2A2 ;空き領域を利用
NerfedSpike_V:
	;トゲの上に着地するときは、続く処理でノックバックが消えてしまう。
	;そのため、ここでY座標を調整しつつ、縦方向には壁に触れていないことにする
	lda <$2C
	cmp #$06 ;「空中」状態
	bne .NotFixCollisionState
	lda $0640 ;下に移動している
	bpl .NotFixCollisionState
	;トゲによる自機の押し戻し
	lda <$0A
	and #$0F
	sta <$32
	sec
	lda $04A0
	sbc <$32
	sta $04A0
	;壁には触れていないという扱いにする
	lda #$00
	sta <$32
	sta <$33
.NotFixCollisionState
NerfedSpike_H:
	sec
	lda $06C0 ;HP
	sbc #(4) ;ダメージ量
	bpl .NotFixHP
	lda #$00
.NotFixHP
	sta $06C0 ;HP
	beq .Dead
	jmp $D32F ;ノックバック
.Dead
	sta <$2C ;ロックマンの状態
	pla
	pla
	jmp $C10B

