!function(){"use strict";(window.PopIn||{}).define("Common",{})}(),function(e,n){"use strict";function t(e){return"object"==typeof e&&"function"==typeof e.getItem&&"function"==typeof e.setItem&&"function"==typeof e.removeItem}function i(){return null}var r,o,s={STORAGE_NAME_MAP:{local:"localStorage",session:"sessionStorage"}},a={get:function(e,t){return n[this.STORAGE_NAME_MAP[e]].getItem(t)},set:function(e,t,i){return n[this.STORAGE_NAME_MAP[e]].setItem(t,i)},remove:function(e,t){return n[this.STORAGE_NAME_MAP[e]].removeItem(t)}};try{r=t(n.sessionStorage)&&t(n.localStorage)}catch(e){r=!1}for(o in a)s[o]=!0===r?a[o]:i;e.define("Common.Storage",s)}(window.PopIn,window),function(e){"use strict";function s(){for(var e={},t=0;t<arguments.length;t++){var i,n=arguments[t];for(i in n)e[i]=n[i]}return e}function c(e){return e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)}e.define("Common.Cookie",function e(a){function i(e,t,i){if("undefined"!=typeof document){"number"==typeof(i=s(o.defaults,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),t=a.write?a.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var n,r="";for(n in i)i[n]&&(r+="; "+n,!0!==i[n]&&(r+="="+i[n].split(";")[0]));return document.cookie=e+"="+t+r}}var o={defaults:{path:"/"},set:i,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],i={},n=0;n<t.length;n++){var r=t[n].split("="),o=r.slice(1).join("=");'"'===o.charAt(0)&&(o=o.slice(1,-1));try{var s=c(r[0]);if(i[s]=(a.read||a)(o,s)||c(o),e===s)break}catch(e){}}return e?i[e]:i}},remove:function(e,t){i(e,"",s(t,{expires:-1}))},withConverter:e};return o}(function(){}))}(window.PopIn,window),function(n){"use strict";var t="_ss_pp_id",r="_ss_pp_id",i=/^[\d\w]{32}|\d{13}$/,o="OPT_OUT",s="uid_gen_time",a=!1,c="";function e(){var e=new Date;return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),""+e.getTime()}function d(e){var t=parseInt(Math.floor(Math.random()*Math.pow(16,e))).toString(16);return(""+Math.pow(10,e)+t).slice(-e)}function u(e){return(i.test(e)||o===e)&&e}function h(e){n.Common.Storage.set("local",t,e),function(){var e,t=location.host.split("."),i=t.length-2;do{if(e="."+t.slice(i).join("."),n.Common.Cookie.set(r,c,{expires:365,domain:e,path:"/"}),n.Common.Cookie.get(r))break}while(0<=--i)}()}h(c=u(n.Common.Cookie.get(r))||u(n.Common.Storage.get("local",t))||(a=!0,n.Common.Storage.set("local",s,e()),[d(8),d(4),d(4),d(3),e()].join(""))),n.define("Common.Uid",{getUid:function(){return c},setUid:function(e,t){var i;u(e)&&(e===c||a||(i=n.Common.Utils.getUserInfo(),function e(t){window.Treasure2?new window.Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:"popin_user_id"}).addRecord("popin_uid_change_log",t):setTimeout(function(){e(t)},1e3)}({previous_id:c,current_id:e,host:location.host,media:t||"",os:i.os,device:n.DEVICE||"",os_version:i.os_version,browser:i.browser,browser_version:i.browser_version,screen:i.screen,viewport:i.viewport,charset:i.charset,language:i.language,color:i.color})),h(c=e),a=!1)},getUidCTime:function(){return c&&13<c.length?c.substring(c.length-13,c.length):""},getUidGenTime:function(){var e="",t=this.getUidCTime(),i=n.Common.Storage.get("local",s);return new RegExp("^[0-9]*$").test(t)?e=t:i&&(e=i),e}})}(window.PopIn,window),function(e,s){"use strict";e.createClass("Common.NodeBuilder",function(e){this.structures=e},{build:function(){return!1===Array.isArray(this.structures)&&(this.structures=[this.structures]),this.createNodes(this.structures)},createNodes:function(e){for(var t,i,n=s.createDocumentFragment(),r=0,o=e.length;r<o;r++)"object"==typeof(i=e[r])&&(t=this.createNode(i),i=i.children,!0===Array.isArray(i)&&0<i.length&&(i=this.createNodes(i),t.appendChild(i)),n.appendChild(t));return this._getTopNode(n)},createNode:function(e){var t=s.createElement(e.tagName);return this._setProperty(t,e.property),this._setClass(t,e.classList),t},_getTopNode:function(e){return 1<e.childElementCount||e.children&&1<e.children.length||1<e.childNodes.length?e:e.firstElementChild||e.firstChild},_setProperty:function(e,t){var i,n;if("object"==typeof t)for(n in t)"object"==typeof(i=t[n])?this._setProperty(e[n],i):e[n]=i},_setClass:function(e,t){if(t){var i=e.classList;if(!0===Array.isArray(t))for(var n=0,r=t.length;n<r;n++)i.add(t[n]);else i.add(t)}}})}(window.PopIn,document),function(r,s,a,c){"use strict";var o=r.Common.NodeBuilder,d="__popIn_dom_key__",u=[];r.define("Common.Utils",{replaceAll:function(e,t){if(!e||!t)return e;for(var i,n=e,r=0,o=t.length;r<o;r++)for(var s in i=t[r])n=n.replace(new RegExp(s),i[s]);return n},getClientHW:function(){return null!=window.innerWidth?{width:window.innerWidth,height:window.innerHeight}:"CSS1Compat"===document.compatMode?{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}:{width:document.body.clientWidth,height:document.body.clientHeight}},convertQueryStringToObject:function(e){for(var t,i=e.replace(/^\?/,"").split("&"),n={},r=0,o=i.length;r<o;r++)n[(t=i[r].split("="))[0]]=t[1];return n},getRootDomain:function(e){for(var t=e.split("."),i=[],n=t.pop();0<t.length&&"www"!==n&&(i.push(n),!(3<n.length&&0<i.length));n=t.pop());return i.reverse().join(".")},setValueToObjectIfConditionIsMet:function(e,t,i,n){!0===e&&(n[i]=t)},createIframeBodyOuterHTML:function(e){var t=[];return t.push('<body style="margin:0px;padding:0px;background-color: transparent;">',"<script>window.inDapIF = true;<\/script>",e,"</body>"),t.join("")},writeCodeInIframe:function(e){var t=this.createIFrameObject("javascript:false");a.body.appendChild(t.element),t.write(this.createIframeBodyOuterHTML(e))},createIFrameObject:function(e,t){return{element:new o({tagName:"iframe",property:{src:e=e||"about:self",scrolling:"no",frameBorder:0,style:{display:(t=t||{}).display||"block",width:t.width||0,height:t.height||0,margin:t.margin||0,padding:t.padding||0,overflow:t.overflow||"none"}}}).build(),write:function(e){var t=this.element;null===t.contentDocument?setTimeout(this.write.bind(this,e),r.RETRY_INTERVAL):this._writeTextInIframe(t,e)},_writeTextInIframe:function(e,t){e=e.contentDocument;e.open(),e.write(t),e.close()}}},DIGEST_CHARS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!$",digest:function(e){for(var t=0,i="",n=0,r=e.length;n<r;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;for(var o=0;o<6;o++)i+=this.DIGEST_CHARS.charAt(63&t),t>>>=6;return i},shuffle:function(e){for(var t,i,n=e.length;0!==n;)i=Math.floor(Math.random()*n),t=e[--n],e[n]=e[i],e[i]=t;return e},requestByJSONP:function(e,t){void 0===this.requestByJSONP._count&&(this.requestByJSONP._count=0);var i=r.JSONP_REQUEST_CALLBACK+this.requestByJSONP._count;if(void 0!==s[i])return this.requestByJSONP._count++,void this.requestByJSONP.call(this,e,t);s[i]=function(e){"function"==typeof t&&t(e),delete s[i]};var n=new o({tagName:"script",property:{src:e+"&callback="+i,type:"text/javascript",charSet:"UTF-8",async:!0}}),e=a.getElementsByTagName("script")[0];e.parentNode.insertBefore(n.build(),e),this.requestByJSONP._count++},getOS:function(e){switch(!0){case/Android/.test(e):return"Android";case/iPhone|iPad|iPod/.test(e):return"iOS";case/Windows/.test(e):return"Windows";case/Mac OS X/.test(e):return"Mac"}return"other"},_normalizeSemverString:function(e){e=e.split(/[._]/);return(parseInt(e[0],10)||0)+"."+(parseInt(e[1],10)||0)+"."+(parseInt(e[2],10)||0)},_getVersion:function(e,t){try{return this._normalizeSemverString(e.split(t)[1].trim().split(/[^\w.]/)[0])}catch(e){}return"0.0.0"},getOSVersion:function(e,t){switch(t){case"Android":return this._getVersion(e,"Android");case"iOS":return this._getVersion(e,/OS /);case"Windows":return this._getVersion(e,/Phone/.test(e)?/Windows Phone (?:OS )?/:/Windows NT/);case"Mac":return this._getVersion(e,/Mac OS X /)}return"0.0.0"},getBrowser:function(e){switch(!0){case/CriOS/.test(e):return"Chrome for iOS";case/Edge/.test(e):return"Edge";case/Chrome/.test(e):return"Chrome";case/Firefox/.test(e):return"Firefox";case/Android/.test(e):return"AOSP";case/MSIE|Trident/.test(e):return"IE";case/Safari\//.test(e):return"Safari";case/AppleWebKit/.test(e):return"WebKit";case/Vivaldi/.test(e):return"Vivaldi"}return""},getBrowserVersion:function(e,t){switch(t){case"Chrome for iOS":return this._getVersion(e,"CriOS/");case"Edge":return this._getVersion(e,"Edge/");case"Chrome":return this._getVersion(e,"Chrome/");case"Firefox":return this._getVersion(e,"Firefox/");case"Vivaldi":return this._getVersion(e,"Vivaldi/");case"AOSP":return this._getVersion(e,/Silk/.test(e)?"Silk/":"Version/");case"IE":return/IEMobile/.test(e)?this._getVersion(e,"IEMobile/"):/MSIE/.test(e)?this._getVersion(e,"MSIE "):this._getVersion(e,"rv:");case"Safari":return this._getVersion(e,"Version/");case"Webkit":return this._getVersion(e,"WebKit/")}return""},getScreen:function(){var e=s.screen;try{e=s.parent.screen}catch(e){}return e?[e.width,e.height].join("x"):"-"},getViewPort:function(){var e=a.documentElement,t=e&&e.clientHeight,i=e&&e.clientWidth,n=s.innerHeight,e=s.innerWidth;return(i<e?e:i)+"x"+(t<n?n:t)},getUserInfo:function(){if(this.getUserInfo._chached)return this.getUserInfo._chached;var e=s.navigator,t=e.userAgent,i=this.getOS(t),n=this.getOSVersion(t,i),r=this.getBrowser(t),o=this.getBrowserVersion(t,r);return this.getUserInfo._chached={os:i,os_version:n,browser:r,browser_version:o,screen:this.getScreen(),viewport:this.getViewPort(),user_agent:t,referrer:a.referrer,path:c.pathname,charset:(a.characterSet||a.charset||"-").toLowerCase(),language:e&&(e.language||e.language||e.browserLanguage||"-").toLowerCase(),color:s.screen?s.screen.colorDepth+"-bit":"-",title:a.title,url:c.href.split("#")[0],platform:e.platform,host:c.host,device:this.getDevice()}},parseUrl:function(e){var t,r={};return 0<e.indexOf("?")&&(t=e.substring(e.indexOf("?")),e=e.substring(0,e.indexOf("?")),t.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(e,t,i,n){r[t]=n})),{url:e,qString:r}},parseUri:function(e){e=e.match(/^(?:([^:/?#]+):)?(?:\/\/([^/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/);return null===e?null:{scheme:e[1],host:e[2],path:e[3],query:e[4],fragment:e[5]}},convertObjectToParameterString:function(e){var t,i,n="";for(i in e)void 0!==(t=e[i])&&(n+=(""===n?"":"&")+i+"="+t);return n},killEvent:function(e){e.preventDefault(),e.stopPropagation()},renderNode:function(e,t,i){switch(i.toLowerCase()){case"beforebegin":t.parentNode.insertBefore(e,t);break;case"afterbegin":t.insertBefore(e,t.firstChild);break;case"beforeend":t.appendChild(e);break;case"afterend":t.parentNode.insertBefore(e,t.nextSibling)}},getSupportedDevice:function(){return void 0!==this.getSupportedDevice._device?this.getSupportedDevice._device:this.getSupportedDevice._device="mobile"===this.getDevice(navigator.userAgent)?"mobile":"pc"},generateBasicLogValue:function(e){var t,i,n="";for(i in e=e||{})void 0!==(t=e[i])&&(n+=(""===n?"":"|")+encodeURIComponent(i+t));return n},generateR5Value:function(e){var t,i={};for(t in e=e||{})i[t+"_"]=e[t];return this.generateBasicLogValue(i)},includes:function(e,t){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return!0;return!1},requestByImageBeacon:function(e,t,i){var n=new Image;"function"==typeof t&&n.addEventListener("load",t,!1),"function"==typeof i&&n.addEventListener("error",i,!1),n.src=e},getPosition:function(e){var t=e.getBoundingClientRect(),i=s.pageXOffset,e=s.pageYOffset;return{top:e+t.top,left:i+t.left,right:i+t.right,bottom:e+t.bottom}},getSize:function(e){return{width:e.offsetWidth,height:e.offsetHeight}},calculateNodeArea:function(e){return e.offsetWidth*e.offsetHeight},getPopInDomData:function(e,t){if(!e)return{};e=+e[d];if("number"!=typeof e||NaN===e)return null;e=u[e]||null;return"string"==typeof t?e[t]:e},setPopInDomData:function(e,t,i){if(!e)return null;var n=e[d]||"",r={};return""===n?(n=u.length,e[d]=n):r=u[n=+n]||{},"string"==typeof t?r[t]=i:"[object Object]"===Object.prototype.toString.call(t)&&(r=Object.assign(r,t)),u[n]=r},getGMTTimeStamp(){var e=new Date;return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),""+e.getTime()},getDevice:function(){var e=window.navigator.userAgent;return/(tablet|ipad|playbook|silk)|(?!.*android.?_).*(?=android(?!.*mobile))/i.test(e)?"tablet":/Android|webOS|iPhone|iPod|BlackBerry|Windows Phone/i.test(e)?"mobile":"pc"}})}(window.PopIn,window,document,window.location),function(e,t){"use strict";var i=e.Common,n=i.Utils,r=i.NodeBuilder;e.define("Common.CSSManager",{css:"",_cache:[],_node:void 0,add:function(e){"object"==typeof e&&(e=this.convertObjectToCSS(e));var t=n.digest(e),i=this._cache;!1===n.includes(t,i)&&(this.css+=e,i.push(t))},convertObjectToCSS:function(e){return JSON.stringify(e,null,"\n").replace(/,[\n\r]/g,";").replace(/[\n\r]|^{|}$|"/g,"").replace(/:\s?{/g,"{").replace(/};?/g,";}")},render:function(){void 0===this._node?this._node=this._createNode(this.css):this._node.textContent+=this.css,this.css=""},_createNode:function(e){e=new r({tagName:"style",property:{type:"text/css",rel:"stylesheet",charSet:"UTF-8",textContent:e}}).build();return t.getElementsByTagName("head")[0].appendChild(e),e}})}(window.PopIn,document),function(){"use strict";(window.PopIn||{}).createClass("Common.Publisher",function(){this._subscribers={}},{on:function(e,t){var i=this._subscribers;return!1===Array.isArray(i[e])&&(i[e]=[]),i[e].push(t),{off:this.off.bind(this,e,t)}},off:function(e,t){e=this._subscribers[e];!1!==Array.isArray(e)&&(t=e.indexOf(t),e.splice(t,1))},trigger:function(e){var t=this._subscribers[e];if(!1!==Array.isArray(t))for(var i,n=[].slice.call(arguments,1),r=0,o=t.length;r<o;r++)"function"==typeof(i=t[r])&&i.apply(null,n)}})}(),function(e,n,t){"use strict";e.inherit("Common.Timer",e.Common.Publisher,function(){var e=this.constructor;if(void 0!==e._instance)return e._instance;this._queue=[],this._isStarted=!1,this._length=0,this._updateCount=0,this._isInitialised=!1,e._instance=this},{UPDATE_INTERVAL:50,set:function(e,t,i){i=i||this._length;t=Math.round(t/this.UPDATE_INTERVAL);return this._length=this._queue.push({key:i,handler:e,timing:1<=t?t:1}),!1===this._isInitialised&&(n.addEventListener("visibilitychange",this._toggleActive.bind(this),!1),this._isInitialised=!0),this._start(),i},remove:function(e){for(var t=this._queue,i=0,n=t.length;i<n;i++)if(t[i].key===e)return t.splice(i,1),this._length--,!0;return!1},_update:function(){var e=this._queue;if(0===e.length)return this._stop(),void(this._updateCount=0);this._updateCount++;for(var t,i=this._updateCount,n=0,r=e.length;n<r;n++)i%(t=e[n]).timing==0&&t.handler();this.trigger("update",this)},_start:function(){if(!0===this._isStarted)return!1;this._isStarted=!0,this._timer=setInterval(this._update.bind(this),this.UPDATE_INTERVAL)},_stop:function(){if(!1===this._isStarted)return!1;clearInterval(this._timer),this._isStarted=!1},_toggleActive:function(){!0===t.hidden?this._stop():this._start()}})}(window.PopIn,window,document),function(i,n){"use strict";i.define("Common.NodeObserver",{DEFAULT_UPDATE_INTERVAL:100,CLASS_NAME_VISIBLE:"visible",targets:[],halfImpTargets:[],_isStarted:!1,_timerKey:null,_subscriber:void 0,_timer:new i.Common.Timer,addTarget:function(e){this.targets.push({node:e.node,onInView:e.onInView,position:e.position||""})},addHalfImpTarget:function(e){this.halfImpTargets.push({node:e.node,onHalfImp:e.onHalfImp})},addTargets:function(e,t){for(var i=0,n=e.length;i<n;i++)this.addTarget({node:e[i],onInView:t})},start:function(){var e=this._timer;!1===this._isStarted&&(this._subscriber=e.on("update",this._onUpdate.bind(this)),this._isStarted=!0),null===this._timerKey&&(this._timerKey=e.set(this._update.bind(this),this.DEFAULT_UPDATE_INTERVAL))},stop:function(){null!==this._timerKey&&(this._timer.remove(this._timerKey),this._timerKey=null)},_update:function(){for(var e,t=this.targets,i=this.halfImpTargets,n=0,r=t.length;n<r;n++){var o,s=(o=t[n]).node;!0===(o.position?this._isVisible(o):this._isVisible(s))&&(s.classList.add(this.CLASS_NAME_VISIBLE),t.splice(n,1),"function"==typeof o.onInView&&o.onInView(s),n--,r--)}for(var a=0,c=i.length;a<c;a++)s=(e=i[a]).node,!0===this._isHalfImp(s)&&(i.splice(a,1),"function"==typeof e.onHalfImp&&e.onHalfImp(s),a--,c--)},_onUpdate:function(){0===this.targets.length&&0===this.halfImpTargets.length&&(this._subscriber.off(),this.stop())},_isVisible:function(e){var t;return e.position?0<(t=e.node.getBoundingClientRect().top)&&n.innerHeight-t>i.Common.Utils.getClientHW().height/3:0<(t=e.getBoundingClientRect().top)&&0<n.innerHeight-t},_isHalfImp:function(e){e=e.getBoundingClientRect().top+(e.getBoundingClientRect().bottom-e.getBoundingClientRect().top)/2;return 0<e&&0<n.innerHeight-e}})}(window.PopIn,window,document),function(n,r,o){"use strict";var s=n.Common,a=s.Utils;n.PROTOCOL;n.inherit("Common.Loader",s.Publisher,function(e){this.target=(e=e||{}).target||o.href,this.apiUrl=e.apiUrl||this.INITIAL_API_URL,0===this.apiUrl.indexOf("http:")&&(this.apiUrl=this.apiUrl.replace("http:","https:")),this.apiUrlAdd=e.apiUrlAdd||"",this.device=e.device||n.DEVICE,this.media=e.media,this.agency=e.agency,this.topn=e.topn||0,this.ad=e.ad||0,this.urlReplace=e.urlReplace,this.useForSzAdLtrRatio=e.useForSzAdLtrRatio,this.infiniteLoadPage=e.infiniteLoadPage,this.useSzAdLtrChannelIdPrefix=e.useSzAdLtrChannelIdPrefix,this.pathnum=e.pathnum,this.needRecommendInformation=e.needRecommendInformation||!1,this.needUserTdInfo=e.needUserTdInfo||!1,this.positionAndStyleObj=null,this.templates=e.templates||[],this.apiHost="",this.country="",this.referrer="",this.requestUrl="",this.popInUserId="",this.userInfo,this.userTdInfo},{INITIAL_API_URL:"https://discoveryplus.popin.cc/popin_discovery/recommend?url=%target",GET_UID_PAGE_URL:"https://api.popin.cc/retarget/uid.html?ac=getuid",SESSION_STORAGE_KEY_UID:"_ss_pp_id",REFFERER_DICTIONARY:{portal_google:/news\.google\.co/,search_yahoo:/search\.yahoo\.co/,sns_facebook:/facebook\.co/,sns_twitter:/twitter\.co|t\.co$/,portal_yahoo:/yahoo\.co/,portal_goo:/goo\.ne/,portal_infoseek:/infoseek\.co/,portal_msn:/msn\.com|www\.msn\.cn/,portal_excite:/excite\.co\.jp/,portal_livedoor:/livedoor\.com/,search_naver:/search\.naver\.com/,sns_naver:/naver\.com|naver\.jp/,sns_hatena:/hatena\.ne\.jp/,portal_aol:/aol\.jp/,search_google:/google\.co/,search_bing:/www\.bing\.com/,portal_biglobe:/www\.biglobe\.ne\.jp/,app_smartnews:/www\.smartnews\.be|www\.smartnews\.com/,app_gunosy:/gunosy\.com/,app_newspicks:/newspicks\.com/,app_antenna:/antenna\.jp/,paid_outbrain:/paid\.outbrain\.com/,paid_yahoo:/trc\.taboola\.com/,paid_logly:/dsp\.logly\.co\.jp/,search_baidu:/www\.baidu\.com/,"search_m-sm":/m\.sm\.cn/,search_so:/www\.so\.com/,search_sogou:/www\.sogou\.com/,"portal_news-baidu":/news\.baidu\.com/,portal_sina:/www\.sina\.com\.cn/,portal_sohu:/www\.sohu\.com/,portal_qq:/www\.qq\.com/,portal_163:/www\.163\.com/,"portal_hao-360":/hao\.360\.cn/,portal_china:/www\.china\.com/,"sns_wechat)":/www\.wechat\.com/,"sns_tieba-baidu":/tieba\.baidu\.com/,sns_weibo:/www\.weibo\.com/,sns_xiaohongshu:/www\.xiaohongshu\.com/},load:function(){var e=this.apiUrl;this.target=this._formatUrl(this.target),this.positionAndStyleObj=this.getPositionAndStyle();var t,i=e.match(/(jp|tw|kr).popin.cc/);this.country=Array.isArray(i)?i[1]:"",this.apiHost=a.parseUri(e).host.replace("discoveryplus.","jp."),this.userInfo=a.getUserInfo(),this.userTdInfo=!0===this.needUserTdInfo?this._generateUserTdInfo():"",this.popInUserId=n.Common.Uid.getUid(),this.referrer=this._getReferrer(),this.setSzAdLtrByBatch(),!0===this.needRecommendInformation?(t=this._generateRequestUrl(this.target),0<this.ad&&0<this.templates.length&&(this._reqLogInit(),n.Common.Performance.updateApiUrl(t,this.apiHost),n.Common.Performance.addTimeMark("request_api_start")),a.requestByJSONP(t,this._onResponse.bind(this))):this.trigger("response",this),0<this.templates.length&&(t=((e=this.apiUrl+"&"+this.apiUrlAdd).match(/[\?&]rid=([^&]+)/)||["",""])[1],e=(e.match(/[\?&]alg=([^&]+)/)||["",""])[1],s.rid=t,s.alg=e)},_onResponse:function(e){this._setUid(e.cookie),this.responseData=e,this.trigger("response",this)},_generateRequestUrl:function(e){var t=this.apiUrl.replace(/%target/g,encodeURIComponent(e)),e=navigator.userAgent,e={media:this.media,agency:this.agency,device:this.device,extra:a.getOS(e).toLowerCase(),topn:this.topn,ad:this.ad||void 0,pathnum:this.pathnum,uid:n.Common.Uid.getUid(),info:this.userTdInfo||void 0};return t+"&"+(a.convertObjectToParameterString(e)+this.apiUrlAdd.replace(/\?/,"&"))},_generateUserTdInfo:function(){if(void 0!==this._generateUserTdInfo.userTdInfo)return this._generateUserTdInfo.userTdInfo;var e,t=a.getUserInfo(),i={};for(e in t)i["user_td_"+e]="title"===e?encodeURIComponent(t[e]):t[e];return i.user_device=this.device,i.user_time=s.Global.startTime,i.fruit_box_position=this.positionAndStyleObj.boxPosition,i.fruit_style=this.positionAndStyleObj.adStyleMonitor,this._generateUserTdInfo.userTdInfo=btoa(unescape(encodeURIComponent(JSON.stringify(i))))},_getReferrer:function(){if(""===r.referrer)return"organic";var e,t=this.REFFERER_DICTIONARY,i=a.parseUri(r.referrer).host||"";for(e in t)if(!0===t[e].test(i))return e;return-1<i.indexOf(o.host)?"site":-1<o.href.indexOf("utm_medium=logly")?"paid_logly":"other"},_formatUrl:function(e){return a.replaceAll(e,this.urlReplace)},_setUid:function(e){e&&e.uid&&n.Common.Uid.setUid(e.uid,this.media)},getPositionAndStyle:function(){var e="",t="",i=s.Storage.get("local","_popIn_box_position_style_key_")||"";return(i=i&&JSON.parse(i))&&0<i.length&&(e=i[0].boxPosition||"",t=i[0].adStyleMonitor||""),{boxPosition:e,adStyleMonitor:t}},setSzAdLtrByBatch:function(){"ignore"!==this.useForSzAdLtrRatio&&-1===this.apiUrl.indexOf("&alg=ltr")&&-1===this.apiUrlAdd.indexOf("&alg=ltr")&&("number"==typeof this.useForSzAdLtrRatio?Math.random()<=this.useForSzAdLtrRatio?(this.apiUrl=this.apiUrl+"&alg=ltr",this.appenedAdLtrPrefix()):this.infiniteLoadPage&&this.removeWthSzPrefix():"tw.popin.cc"!=this.apiHost&&"jp.popin.cc"!=this.apiHost||(this.apiUrl=this.apiUrl+"&alg=ltr"))},appenedAdLtrPrefix:function(){for(var e=void 0===this.useSzAdLtrChannelIdPrefix?"":this.useSzAdLtrChannelIdPrefix,t=0;t<this.templates.length;t++){var i=this.templates[t];i.channelId&&0!==i.channelId.indexOf("with_sz_")&&(i.channelId=e+i.channelId)}},removeWthSzPrefix:function(){for(var e=0;e<this.templates.length;e++){var t=this.templates[e];t.channelId&&0===t.channelId.indexOf("with_sz_")&&(t.channelId=(t.channelId.match(/with_sz_(\S*)/)||[t.channelId,t.channelId])[1])}},_reqLogInit(){n.Common.Logger.send("treasure",{db:"popin_media",table:"discoverylogs",data:{type:15,param1:0,uid:n.Common.Uid.getUid(),media:this.media,device:n.Common.Utils.getDevice(),url:o.href}})}})}(window.PopIn,(window,document),location),function(){"use strict";(window.PopIn||{}).createClass("Common.Message",function(e){this.country=e||"",this.dictionary=this.DICTIONARY[e.toUpperCase()]||this.DICTIONARY.JP},{DICTIONARY:{JP:{video_button_detail:"詳しくはこちら",video_button_calendar:"カレンダーに登録",video_counter:"再生回数 {{value}}回",video_end_replay:"動画をリプレイ",video_end_detail:"詳しくはこちら",read_debug_container:"本文領域",read_debug_info_view:"本文表示率:{{value}}%",read_debug_info_read:"読了率:{{value}}%",read_debug_info_time:"読む時間:{{value}}秒"},TW:{video_button_detail:"深入了解",video_button_calendar:"カレンダーに登録",video_counter:"觀看次數 {{value}}次",video_end_replay:"再看一次",video_end_detail:"瞭解詳情",read_debug_container:"正文",read_debug_info_view:"正文顯示率:{{value}}%",read_debug_info_read:"正文閱讀率:{{value}}%",read_debug_info_time:"正文閱讀時間:{{value}}秒"}},get:function(e){return this.dictionary[e]}})}(),function(e,t){if(void 0===t[e]){t[e]=function(){t[e].clients.push(this),this._init=[Array.prototype.slice.call(arguments)]},t[e].clients=[];for(var i=["getTrackValues","addRecord","set","trackEvent","trackPageview","trackClicks","ready"],n=0;n<i.length;n++){var r=i[n];t[e].prototype[r]=function(e){return function(){return this["_"+e]=this["_"+e]||[],this["_"+e].push(Array.prototype.slice.call(arguments)),this}}(r)}var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src=window.PopIn.PROTOCOL+"//api.popin.cc/td_js_sdk_171.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(o,s)}}("Treasure2",window),function(o,n){"use strict";function i(e){this.writeKey=e,this._loggers={}}var r=o.Common.Utils,e=o.PROTOCOL,s={NORMAL_MODE:"normal",OTHER_MODE:"other",NORMAL_MODE_REQUEST_URL:e+"//rlog.popin.cc/s.gif",OTHER_MODE_REQUEST_URL:e+"//r.popin.cc/log.gif",send:function(e,t,i,n){e=e||this.NORMAL_MODE;t=r.convertObjectToParameterString(t),e=this._getRequestPrefix(e);return r.requestByImageBeacon(e+"?"+t,i,n),this},_getRequestPrefix:function(e){switch(e){case this.NORMAL_MODE:return this.NORMAL_MODE_REQUEST_URL;case this.OTHER_MODE:return this.OTHER_MODE_REQUEST_URL}}},a={REQUEST_URL:e+"//inrecsys.popin.cc/PopinService/Logs/",send:function(e,t){t=t||{};t=JSON.stringify(t),t=btoa(unescape(encodeURIComponent(t)));r.requestByImageBeacon(this.REQUEST_URL+e+"?data="+t)}};(t=i.prototype).open=function(e,t){var i=new n.Treasure2({writeKey:this.writeKey,database:e});i.set("$global","td_global_id","td_global_id"),this._loggers[e]=i,"function"==typeof t&&i.ready(t)},t.ready=function(e,t){this._loggers[e].ready(t)},t.getTrackValues=function(e){return this._loggers[e].getTrackValues()},t.send=function(e,t,i,n,r){return"popin_media"===e&&"discoverylogs"===t?this.sendUts(e,t,i):(this.sendTd(e,t,i,n,r),"popin_ads"===e&&"adlogs"===t&&this.sendUts(e,t,i)),this},t.sendTd=function(e,t,i,n,r){return this._loggers[e].addRecord(t,i,function(){"function"==typeof n&&n()},function(){"function"==typeof r&&r()}),this},t.sendUts=function(e,t,i){var n=r.getUserInfo();i.td_os=n.os,i.td_os_version=n.os_version,i.td_browser=n.browser,i.td_browser_version=n.browser_version,i.td_user_agent=n.user_agent,delete i.td_ip;i=JSON.stringify(i),i=["https://log.popin.cc/log","/"+e,"/"+t,"?data="+btoa(unescape(encodeURIComponent(i))),"&t="+(new Date).getTime()].join("");(new Image).src=i};var t,e=function(){var e=this.constructor;if(void 0!==e._instance)return e._instance;this.isReady=!1,this.basic=s;var t=new i(this.TD_WRITE_KEY);t.open(this.DB_NAME_DISCOVERY_LOG),t.open(this.DB_NAME_AD,this._onReadyTreasure.bind(this,t)),this.treasure=t,this.inrecsys=a,this._sendLog={basic:this._sendBasicLog.bind(this),treasure:this._sendTreasureLog.bind(this),inrecsys:this._sendInrecsysLog.bind(this)},n.addEventListener("touchstart",this._recordUserInteraction,!1),n.addEventListener("click",this._recordUserInteraction,!1),n.addEventListener("mousedown",this._recordUserInteraction,!1),e._alreadyOutputData=[],e._interactionNumber=0,e._lastEvent=!1,e._instance=this};(t=e.prototype).TD_WRITE_KEY="8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",t.DB_NAME_DISCOVERY_LOG="popin_media",t.DB_NAME_AD="popin_ads",t.send=function(e,t){t=t||{};var i=this._sendLog[e];"function"==typeof i&&!0===this._isValid(e,t)&&i(t)},t.getTrackValues=function(){return this.trackValues||null},t.setTzValue=function(e,t){if(e&&"normal"!==e)return t;var i,n={r1:/.*/,type:/(pc|mobile)_viewall/},r=!1;for(i in n)if(t[i]&&n[i].test(t[i])){r=!0;break}return r||(t.tz=o.REQUEST_COUNTRY),t},t.ready=function(e){!0===this.isReady?e():this.treasure.ready(this.DB_NAME_AD,e)},t._onReadyTreasure=function(e){this.isReady=!0,this.trackValues=e.getTrackValues(this.DB_NAME_AD)},t._sendBasicLog=function(e){var t=(e=e||{}).data||{};t.t=Date.now(),t=this.setTzValue(e.mode,t),this.basic.send(e.mode,t,e.onComplete,e.onError)},t._sendTreasureLog=function(e){var t=(e=e||{}).data||{};t.popin_version=o.VERSION,t.interaction_number=this.constructor._interactionNumber;var i,n=this._lastEvent;n&&(n.touches&&(i=n.touches[0],t.interaction_touchx=Math.round(i.pageX),t.interaction_touchy=Math.round(i.pageY)),"mousedown"===n.type&&(t.interaction_mousex=Math.round(n.pageX),t.interaction_mousey=Math.round(n.pageY))),this.treasure.send(e.db,e.table,t,e.onComplete,e.onError)},t._sendInrecsysLog=function(e){var t=(e=e||{}).data||{};t.now=Date.now(),t.popin_version=o.VERSION,this.inrecsys.send(e.api,t)},t._recordUserInteraction=function(e){var t=this.constructor;t._interactionNumber++,t._lastEvent=e},t._isValid=function(e,t){t=t.uniqueId;if("string"==typeof t){e=e+"|"+t,t=this.constructor._alreadyOutputData;if(!0===r.includes(e,t))return!1;t.push(e)}return!0};var c=new e;c.ready(function(){o.define("Common.Logger",c)})}(window.PopIn,window),function(e){"use strict";e.define("Common.Global",{startTime:Date.now(),expectedAndRenderAds:{}})}(window.PopIn,window),function(t,i){"use strict";t.createClass("Common.Messenger",function(e){this.url=(e=e||{}).url,this._iframeNode},{setup:function(){var e=t.Common.Utils.createIFrameObject(this.url).element;i.body.appendChild(e),this._iframeNode=e},send:function(e){this._iframeNode.contentWindow.postMessage(JSON.stringify(e),"*")}})}(window.PopIn,(window,document)),function(i){"use strict";i.define("Common.Performance",{isSupported:window.performance&&"function"==typeof window.performance.getEntries&&"function"==typeof window.performance.now,enableMonitor:!0,sample:.1,isResourceReady:!1,db:"popin_ads",table:"fe_performance_monitor",id:+new Date,marks:{},data:{},_config:{},resourceFilterRules:[function(e,t){if(/popin.cc\/searchbox\/.+\.js$/.test(t.name))return e.addMark("request_config_start",t.startTime),e.set("rcd",parseInt(t.duration,10)),e.addMark("request_config_end",t.responseEnd),!0},function(e,t){if(/popIn-common-8.min\/.+\.js$/.test(t.name))return e.set("rce_rds",parseInt(t.duration,10)),!0},function(e,t){if(/popIn-discovery-8.min\/.+\.js$/.test(t.name))return e.set("rde_di",parseInt(t.duration,10)),!0},function(e,t){if(0===t.name.indexOf(e._config.apiUrl))return e.addMark("request_api_start",t.startTime),e.set("rad",parseInt(t.duration,10)),e.addMark("request_api_end",t.responseEnd),!0}],init:function(e){if(this._config=e,this.isSupported){e=e;return"number"==typeof e.performanceSample&&(this.sample=e.performanceSample),void 0!==e.enablePerformanceMonitor&&(this.enableMonitor=e.enablePerformanceMonitor),Math.random()>this.sample&&(this.enableMonitor=!1),this.addMark("discovery_init",i.__PERFORMANCE_DISCOVERY_INIT__),this.enableMonitor&&this.bindEvent(),this}},updateApiUrl(e,t){this._config.apiUrl=e,this._config.apiHost=t},bindEvent:function(){var e=this;window.addEventListener("load",function(){e.isResourceReady=!0,e.marks.is_box_rendered&&e.report()},!1)},addTimeMark:function(e){return this.isSupported&&("box_did_render"===e&&void 0!==this.marks.box_did_render||(this.marks[e]=window.performance.now())),this},addMark:function(e,t){return this.marks[e]=t,this},set:function(e,t){return this.data[e]=t,this},collectResourceInfo:function(){for(var e,t=window.performance.getEntries(),i=this.resourceFilterRules,n=i.length,r={},o=0;e=t[o++];){for(var s,a=0;s=i[a];a++)if(s(this,e)){r[s.key]=e,i.splice(a,1),n--;break}if(0===n)break}},analyse:function(){var e=this.data,t=i.Common.Utils.getUserInfo();e.host=t.host,e.user_agent=t.user_agent,e.browser=t.browser,e.browser_version=t.browser_version,e.os=t.os,e.os_version=t.os_version,e.device=t.device,e.screen=t.screen,e.api_host=this._config.apiHost,e.media=this._config.media,e.libLoadMode="inline",e.rcs=parseInt(this.marks.request_config_start,10),e.di_awr=this.calculate("discovery_init","api_will_request"),e.awr_ras=this.calculate("api_will_request","request_api_start"),e.rae_adwd=this.calculate("request_api_end","api_data_will_deal"),e.adwd_bdr=this.calculate("api_data_will_deal","box_did_render"),e.total=this.calculate("request_config_start","box_did_render"),e.popin_version=8,e.performance_id=this.id},calculate:function(e,t){var i=this.marks;return void 0===i[e]||void 0===i[t]?"null":parseInt(i[t]-i[e],10)},report:function(){if(this.enableMonitor&&this.isResourceReady&&this.marks.is_box_rendered&&!this.isReported)return this.collectResourceInfo(),this.analyse(),0<this.data.total&&this.log(this.data),this.isReported=!0,this},log:function(e,t,i){i=i||this.db,t=t||this.table;e=JSON.stringify(e);return this.imageLog(["https://log.popin.cc/log","/"+i,"/"+t,"?data="+btoa(unescape(encodeURIComponent(e))),"&t="+(new Date).getTime()].join("")),this},imageLog:function(e){var t=new Image;this.onComplete&&(t.onload=this.onComplete),this.onError&&(t.onerror=this.onError),t.src=e}})}(window.PopIn,(window,document,window.location));