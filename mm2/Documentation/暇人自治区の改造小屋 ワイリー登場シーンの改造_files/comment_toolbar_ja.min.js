(function(){var debug=!1,baseUrl="https://static.fc2.com/js/blog/view/comment/",caller=null,langCode="",target=null,dialog=null,config=null,iframe=null,lang=null,JSON={},cache="",src="",paletteContainerCssText="display: none; position: absolute; top: 27px; left: 0;z-index:100000;",paletteCssText="border: 0 none; height: 200px;",iconListContainerCssText="display: none; position: absolute; top: 27px; left: 0;z-index:100000;",iconListCssText="border: 0 none; height: 391px;width: 267px;",ie=function(){for(var e=3,t=document.createElement("div");t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",t.getElementsByTagName("i")[0];);return e>4?e:void 0}();[Element.prototype,CharacterData.prototype,DocumentType.prototype].forEach(function(e){e.hasOwnProperty("after")||Object.defineProperty(e,"after",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),t=document.createDocumentFragment();e.forEach(function(e){var n=e instanceof Node;t.appendChild(n?e:document.createTextNode(String(e)))}),this.parentNode.insertBefore(t,this.nextSibling)}})});var Config=function(){this.Palette={container:paletteContainerCssText||"display: none; position: absolute; top: 0; left: 0;",table:paletteCssText||"border: 0 none;"},this.Icon={container:iconListContainerCssText||"display: none; position: absolute; top: 0; left: 0;",table:iconListCssText||"border: 0 none;"}};Config.prototype.css=function(e){if(e)switch(e){case"palette":return this.Palette;case"icon":return this.Icon}};var Dialog=function(){this.menu={palette:null,icon:null};new Date;var e=document.getElementById("tools_container");for(var t in this.menu){var n=config.css(t),o="<iframe src='";o+=baseUrl+"dialog/"+t+".html",o+="?u="+encodeURIComponent(location.href),o+="&lang="+encodeURIComponent(langCode),o+="' frameborder='0' style='"+n.table+"'></iframe>";var r=document.createElement("div");r.style.cssText=n.container,r.setAttribute("id","FC2_comment_"+t),r.innerHTML=o,e.appendChild(r),this.menu[t]=r}};Dialog.prototype={show:function(e){e&&"string"==typeof e&&(this.menu[e].style.display="block")},hide:function(e){e&&"string"==typeof e&&(this.menu[e].style.display="none")},setPosition:function(e){if(e)getRect("#tools_container")}};var unescapeUnicode=function(e){try{return e.replace(/\\u([a-fA-F0-9]{4})/g,function(e,t){return String.fromCharCode(parseInt(t,16))})}catch(e){return!1}},toggleSubMenu=function(e){for(var t in dialog.menu)dialog.hide(t);dialog.show(e)},insertTempTag=function(e){var t,n="",o="",r="",a="";/^icon:/.test(e)?(n=(e=e.split(":"))[0].toUpperCase()+"_TAG",a=":"+e[1]):(/^color:/.test(e)?(n=(e=e.split(":"))[0].toUpperCase()+"_TAG",a=":"+e[1]):n=e.toUpperCase()+"_TAG",o="[/"+lang[n][langCode]+"]",r=lang[n+"_TEXT"][langCode]),t="["+lang[n][langCode]+a+"]",_insertTempTag(t,o,r)},_insertTempTag=function(e,t,n){if(target){if(target.focus(),null!=document.selection){var o=document.selection.createRange().text;document.selection.createRange().text=o?e+o+t:e+n+t}else if(target.selectionStart||"0"==target.selectionStart){var r=target.selectionStart,a=target.selectionEnd,i=target.value.substring(r,a);target.value=i?target.value.substring(0,r)+e+i+t+target.value.substring(a,target.value.length):target.value.substring(0,r)+e+n+t+target.value.substring(a,target.value.length),target.focus()}else target.value+=e+n+t;for(var c in dialog.menu)dialog.hide(c)}},getRect=function(e){if(e&&"string"==typeof e){var t=document.getElementById(e);if(t){var n=t.getBoundingClientRect();return{left:n.left-(document.body.scrollLeft||document.documentElement.scrollLeft),top:n.top-(document.body.scrollTop||document.documentElement.scrollTop)}}}},setHeight=function(e,t){if(t)try{dialog.menu[t].style.height=e?e+"px":""}catch(e){}},clearHash=function(){var e=document.documentElement.scrollTop||window.scrollY;window.location=location.href.split("#")[0]+"#fc2CommentToolbar",window.scroll(0,e)},theWriteTag=function(){var e=document.createElement("div");e.id="tools_container",e.style.cssText="position:relative;width:267px;display:inline-block;";var t=document.createElement("a");t.href="javascript:;",t.name="fc2CommentToolbar";var n=document.createElement("iframe");n.id="tools_dialog",n.frameborder="0",n.style.cssText="height:30px;border:0 none;overflow:hidden;width:267px;",e.appendChild(t),e.appendChild(n),caller.after(e)},getCurrentScript=function(){return document.currentScript?document.currentScript:document.querySelector('script[src*="/js/blog/view/comment/comment_toolbar_"]')},setTargetElement=function(){var e=setTimeout(function(){target=function(e){if(e)return e.comment?e.comment:null}(document.getElementById("comment_form")||document.comment_form),clearTimeout(e)},100)},setLinkTag=function(){var e=document.createElement("link");e.setAttribute("type","text/css"),e.setAttribute("href",baseUrl+"index.css"),document.body.parentNode.childNodes[0].appendChild(e)},getLanguageCode=function(){var e=caller.getAttribute("src");if(e){var t=e.match(new RegExp(baseUrl+"comment_toolbar_([a-z]{2})?.min.js"));return t&&t[1]?t[1]:"ja"}};function f(e){return e<10?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,o,r,a,i,c=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,i=[],"[object Array]"===Object.prototype.toString.apply(l)){for(a=l.length,n=0;n<a;n+=1)i[n]=str(n,l)||"null";return r=0===i.length?"[]":gap?"[\n"+gap+i.join(",\n"+gap)+"\n"+c+"]":"["+i.join(",")+"]",gap=c,r}if(rep&&"object"==typeof rep)for(a=rep.length,n=0;n<a;n+=1)"string"==typeof rep[n]&&(r=str(o=rep[n],l))&&i.push(quote(o)+(gap?": ":":")+r);else for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(r=str(o,l))&&i.push(quote(o)+(gap?": ":":")+r);return r=0===i.length?"{}":gap?"{\n"+gap+i.join(",\n"+gap)+"\n"+c+"}":"{"+i.join(",")+"}",gap=c,r}}"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var o;if(gap="",indent="","number"==typeof n)for(o=0;o<n;o+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(e,t){var n,o,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(void 0!==(o=walk(r,n))?r[n]=o:delete r[n]);return reviver.call(e,t,r)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")});var receiveMessage=function(e){try{var t=JSON.parse(e.data);for(var n in t)for(var o in t[n])t[n][o]=unescapeUnicode(t[n][o]);var r=t.p;switch(t.m){case"instag":insertTempTag(r.start,r.end,r.str);break;case"tglmenu":toggleSubMenu(r.target);break;case"seth":setHeight(r.height,r.target)}}catch(e){}},workerProcess=function(){try{var e=location.href.split("#");if(1>=e.length)return;var t=decodeURIComponent(e[1]);if(!t.match(/^([0-9]*?)\&/))return;var n=!!t.match(/^([0-9]*?)\&/)&&t.match(/^([0-9]*?)\&/)[1];if(!n||cache==n)return;cache=n;var o=t.replace(/^(?:[0-9]*?\&)/,"");for(var r in o=JSON.parse(o))for(var a in o[r])o[r][a]=unescapeUnicode(o[r][a]);return receiveMessage({data:o}),!0}catch(e){return!1}},setEvent=function(e,t,n){n=n||window,ie<9?"load"===e?n.onreadystatechange=t:n.attachEvent("on"+e,t):n.addEventListener(e,t,!1)},init=function(){(caller=getCurrentScript())&&(langCode=getLanguageCode(),setTimeout(function(){theWriteTag(),setTargetElement(),setLinkTag(),config=new Config,dialog=new Dialog,iframe=document.getElementById("tools_dialog"),src=baseUrl+"comment_toolbar.html",src+="?u="+encodeURIComponent(location.href),src+="&lang="+encodeURIComponent(langCode),iframe.setAttribute("src",src);var e=document.createElement("script");if(setEvent("load",function(){"undefined"!=typeof FC2Blog&&(lang=FC2Blog.Language.CommentTool)},e),e.setAttribute("src",baseUrl+"comment_toolbar.lang.js"),document.getElementsByTagName("head")[0].appendChild(e),debug||!window.postMessage)var t=setInterval(function(){var e=workerProcess();!1===e?clearInterval(t):!0===e&&clearHash()},100);else setEvent("message",receiveMessage)}))};init()})();